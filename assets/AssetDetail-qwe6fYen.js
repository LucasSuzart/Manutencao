import{d as J,H as K,a as X,I as Y,u as Z,c as g,l as P,C as ss,b as y,o as v,e as s,t as l,j as r,w as o,h as m,i as n,x as b,B as p,f as I,g as q,k as R,F as es,r as ts,G as as,_ as is}from"./index-CEWcok4S.js";import{Q as os}from"./QRPanel-DRmxbxSE.js";const ls={key:0,class:"asset-detail page"},ns={class:"page-header"},rs={class:"asset-header"},ds={class:"asset-title"},us={class:"muted"},cs={class:"detail-grid"},vs={class:"detail-main"},ms={class:"asset-image-container"},ps=["src","alt"],fs={class:"info-grid"},gs={class:"info-row"},_s={class:"info-value"},hs={class:"info-row"},ys={class:"info-value"},bs={class:"info-row"},ws={class:"info-value"},ks={class:"info-row"},Os={class:"info-value"},qs={class:"info-row"},As={class:"info-value"},Cs={class:"info-row"},Is={class:"info-value"},Rs={key:0,class:"empty-item"},Ss={class:"order-summary"},Ms={class:"order-summary-item"},Ds={class:"order-summary-header"},Ps={class:"order-count"},Ts={class:"order-summary-action"},xs={class:"order-summary-item"},Ns={class:"order-summary-header"},$s={class:"order-count"},Bs={class:"order-summary-action"},zs={class:"card-header"},Es={key:0,class:"empty-history"},Vs={key:1,class:"order-history"},Us={class:"order-header"},Ws={class:"order-title"},js={class:"order-info"},Ls={class:"order-details"},Qs={class:"order-type"},Fs={class:"order-date"},Gs={class:"detail-side"},Hs={class:"info-grid"},Js={class:"info-row"},Ks={class:"info-value"},Xs={class:"info-row"},Ys={class:"info-value"},Zs={class:"info-row"},se={class:"info-value"},ee={class:"info-row"},te={class:"info-value"},ae={class:"card-header"},ie={class:"qr-container"},oe=["href"],le={class:"responsible-section"},ne={class:"responsible-info"},re={class:"responsible-name"},de={class:"metrics"},ue={class:"metric-item"},ce={class:"metric-value"},ve={class:"metric-item"},me={class:"metric-value"},pe={class:"metric-item"},fe={class:"metric-value"},ge={class:"metric-item"},_e={class:"metric-value"},he={class:"metric-item"},ye={class:"metric-value"},be={class:"metric-item"},we={class:"metric-value"},ke={key:1,class:"asset-not-found page"},Oe=J({__name:"AssetDetail",setup(qe){const T=K(),k=as(),w=T.params.id,x=X(),N=Y(),$=Z(),i=g(()=>x.byId(w)),A=P(!1);ss(i,()=>{A.value=!1});const B=g(()=>{var t;return(t=i.value)!=null&&t.location?N.byId(i.value.location):null});function z(){return"https://lucassuzart.github.io/Manutencao"}const C=g(()=>`${z()}/ativos/${w}`),S=P(null);function E(){var u;const t=(u=S.value)==null?void 0:u.toDataURL();if(!t||!i.value)return;const e=window.open("","_blank","width=400,height=500");if(!e)return;const a=`
    <html>
    <head>
      <meta charset="utf-8" />
      <title>QR - ${i.value.name}</title>
      <style>
        body { font-family: Arial, sans-serif; text-align:center; padding: 12px; }
        img { width: 240px; height: 240px; }
        .name { margin-top: 8px; font-weight: 600; }
        .code { color: #555; }
      </style>
    </head>
    <body>
      <img src="${t}" alt="QR" />
      <div class="name">${i.value.name}</div>
      <div class="code">${i.value.code}</div>
      <script>window.onload = () => { window.print(); setTimeout(() => window.close(), 300); };<\/script>
    </body>
    </html>`;e.document.write(a),e.document.close()}const V=g(()=>[]),U=g(()=>"TIME MANUTENÇÃO");g(()=>{const t=c.value.filter(e=>e.type==="inspection"&&e.status==="completed");return t.length===0?null:t.sort((e,a)=>new Date(a.completedAt).getTime()-new Date(e.completedAt).getTime())[0].completedAt});const c=g(()=>i.value?$.workOrders.filter(t=>t.assetId===w).sort((t,e)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()):[]),f=g(()=>{if(!c.value.length)return{totalOrders:0,pendingOrders:0,lastMaintenance:null,completedOrders:0,completionRate:0,corrective:0,preventive:0};const t=c.value.length,e=c.value.filter(d=>d.status!=="completed"&&d.status!=="canceled").length,a=c.value.filter(d=>d.status==="completed").length,u=c.value.filter(d=>d.completedAt).sort((d,H)=>new Date(H.completedAt).getTime()-new Date(d.completedAt).getTime())[0],_=c.value.filter(d=>d.type==="corrective").length,h=c.value.filter(d=>d.type==="preventive"||d.type==="predictive"||d.type==="inspection").length;return{totalOrders:t,pendingOrders:e,completedOrders:a,completionRate:t?Math.round(a/t*100):0,lastMaintenance:(u==null?void 0:u.completedAt)||null,corrective:_,preventive:h}});function O(t){return t?new Date(t).toLocaleDateString("pt-BR"):"N/A"}function W(){k.push({name:"assets-edit",params:{id:w}})}function j(){var t;k.push({name:"workorders-new",query:{assetId:w,assetName:(t=i.value)==null?void 0:t.name}})}function L(t){k.push({name:"workorder-detail",params:{id:t}})}function M(t){k.push({name:"workorders",query:{assetId:w,status:t==="pending"?["open","in_progress","paused"]:["completed"]}})}function Q(t){if(!t)return"";if(t.startsWith("data:")||t.startsWith("http://")||t.startsWith("https://"))return t;const e="/Manutencao/";return t.startsWith("/")?e.replace(/\/$/,"")+t:e+t}const D="/Manutencao/placeholder.svg";function F(){var e,a;if(A.value)return D;const t=Q((e=i.value)==null?void 0:e.imageUrl);return console.log("Asset image URL:",t,"Original:",(a=i.value)==null?void 0:a.imageUrl),t||D}function G(){A.value=!0}return(t,e)=>i.value?(v(),y("div",ls,[s("div",ns,[s("div",rs,[e[3]||(e[3]=s("div",{class:"asset-icon"},[s("i",{class:"fas fa-cogs"})],-1)),s("div",ds,[s("h1",null,l(i.value.name),1),s("p",us,"Código: "+l(i.value.code),1)])]),s("div",null,[r(n(b),{variant:"secondary",onClick:W},{default:o(()=>[...e[4]||(e[4]=[m("Editar",-1)])]),_:1})])]),s("div",cs,[s("div",vs,[r(n(p),{class:"asset-image-card"},{default:o(()=>[s("div",ms,[s("img",{src:F(),alt:`Imagem de ${i.value.name}`,class:"asset-image",onError:G},null,40,ps)])]),_:1}),r(n(p),null,{header:o(()=>[...e[5]||(e[5]=[s("h3",null,"Informações de Manutenção",-1)])]),default:o(()=>{var a,u,_,h;return[s("div",fs,[s("div",gs,[e[6]||(e[6]=s("div",{class:"info-label"},"Status:",-1)),s("div",_s,[i.value.status?(v(),I(n(R),{key:0,status:i.value.status,type:"asset"},null,8,["status"])):q("",!0)])]),s("div",hs,[e[7]||(e[7]=s("div",{class:"info-label"},"Criticidade:",-1)),s("div",ys,[i.value.criticality?(v(),I(n(R),{key:0,status:i.value.criticality,type:"criticality"},null,8,["status"])):q("",!0)])]),s("div",bs,[e[8]||(e[8]=s("div",{class:"info-label"},"Instalação:",-1)),s("div",ws,l(O((a=i.value)==null?void 0:a.installationDate)),1)]),s("div",ks,[e[9]||(e[9]=s("div",{class:"info-label"},"Última falha:",-1)),s("div",Os,l(O((u=i.value)==null?void 0:u.lastFailureAt)),1)]),s("div",qs,[e[10]||(e[10]=s("div",{class:"info-label"},"Último reparo:",-1)),s("div",As,l(O((_=i.value)==null?void 0:_.lastRepairAt)),1)]),s("div",Cs,[e[11]||(e[11]=s("div",{class:"info-label"},"Localização:",-1)),s("div",Is,l(((h=B.value)==null?void 0:h.name)||"-"),1)])])]}),_:1}),r(n(p),null,{header:o(()=>[...e[12]||(e[12]=[s("h3",null,"Solicitações",-1)])]),default:o(()=>[V.value.length?q("",!0):(v(),y("div",Rs,[...e[13]||(e[13]=[s("p",null,"Nenhuma solicitação de manutenção planejada para este ativo.",-1)])])),e[14]||(e[14]=s("div",{class:"request-list"},[s("div",{class:"request-item"},[s("div",{class:"request-icon"},[s("i",{class:"fas fa-clipboard-list"})]),s("div",{class:"request-content"},[s("div",{class:"request-title"},"Verificação das Pás"),s("div",{class:"tag-container"},[s("span",{class:"tag tag-success"},"Planejada")])])]),s("div",{class:"request-item"},[s("div",{class:"request-icon"},[s("i",{class:"fas fa-search"})]),s("div",{class:"request-content"},[s("div",{class:"request-title"},"Inspeção Preventiva"),s("div",{class:"tag-container"},[s("span",{class:"tag tag-success"},"Planejada")])])]),s("div",{class:"request-item"},[s("div",{class:"request-icon"},[s("i",{class:"fas fa-clipboard-list"})]),s("div",{class:"request-content"},[s("div",{class:"request-title"},"Verificação das Pás"),s("div",{class:"tag-container"},[s("span",{class:"tag tag-success"},"Planejada")])])]),s("div",{class:"request-item"},[s("div",{class:"request-icon"},[s("i",{class:"fas fa-search"})]),s("div",{class:"request-content"},[s("div",{class:"request-title"},"Inspeção Preventiva"),s("div",{class:"tag-container"},[s("span",{class:"tag tag-success"},"Planejada")])])])],-1))]),_:1}),r(n(p),null,{header:o(()=>[...e[15]||(e[15]=[s("h3",null,"Ordens de Serviço",-1)])]),default:o(()=>[s("div",Ss,[s("div",Ms,[s("div",Ds,[e[16]||(e[16]=s("span",null,"Em aberto:",-1)),s("span",Ps,l(f.value.pendingOrders),1)]),s("div",Ts,[r(n(b),{variant:"ghost",size:"sm",onClick:e[0]||(e[0]=a=>M("pending"))},{default:o(()=>[...e[17]||(e[17]=[m("Visualizar →",-1)])]),_:1})])]),s("div",xs,[s("div",Ns,[e[18]||(e[18]=s("span",null,"Concluídas:",-1)),s("span",$s,l(f.value.completedOrders),1)]),s("div",Bs,[r(n(b),{variant:"ghost",size:"sm",onClick:e[1]||(e[1]=a=>M("completed"))},{default:o(()=>[...e[19]||(e[19]=[m("Visualizar →",-1)])]),_:1})])])])]),_:1}),r(n(p),{class:"history-card"},{header:o(()=>[s("div",zs,[e[21]||(e[21]=s("h3",null,"Histórico de Manutenção",-1)),r(n(b),{variant:"primary",size:"sm",onClick:j},{default:o(()=>[...e[20]||(e[20]=[m("Nova OS",-1)])]),_:1})])]),default:o(()=>[c.value.length===0?(v(),y("div",Es,[...e[22]||(e[22]=[s("p",null,"Nenhuma ordem de serviço registrada para este ativo.",-1)])])):(v(),y("div",Vs,[(v(!0),y(es,null,ts(c.value,a=>(v(),y("div",{key:a.id,class:"order-item"},[s("div",Us,[s("div",Ws,[s("strong",null,l(a.code),1),m(" - "+l(a.title),1)]),r(n(R),{status:a.status,type:"workorder"},null,8,["status"])]),s("div",js,[s("div",Ls,[s("div",Qs,[e[23]||(e[23]=s("span",{class:"label"},"Tipo:",-1)),m(" "+l(a.type==="corrective"?"Corretiva":a.type==="preventive"?"Preventiva":a.type==="predictive"?"Preditiva":a.type==="inspection"?"Inspeção":"Melhoria"),1)]),s("div",Fs,[e[24]||(e[24]=s("span",{class:"label"},"Data:",-1)),m(" "+l(O(a.createdAt)),1)])]),r(n(b),{variant:"ghost",size:"sm",onClick:u=>L(a.id)},{default:o(()=>[...e[25]||(e[25]=[m(" Ver detalhes ",-1)])]),_:1},8,["onClick"])])]))),128))]))]),_:1})]),s("div",Gs,[r(n(p),null,{header:o(()=>[...e[26]||(e[26]=[s("h3",null,"Informações Gerais",-1)])]),default:o(()=>{var a,u,_,h;return[s("div",Hs,[s("div",Js,[e[27]||(e[27]=s("div",{class:"info-label"},"Modelo:",-1)),s("div",Ks,l(((a=i.value)==null?void 0:a.model)||"Motobomba"),1)]),s("div",Xs,[e[28]||(e[28]=s("div",{class:"info-label"},"Fabricante:",-1)),s("div",Ys,l(((u=i.value)==null?void 0:u.manufacturer)||"-"),1)]),s("div",Zs,[e[29]||(e[29]=s("div",{class:"info-label"},"Série:",-1)),s("div",se,l(((_=i.value)==null?void 0:_.serialNumber)||"-"),1)]),s("div",ee,[e[30]||(e[30]=s("div",{class:"info-label"},"Categoria:",-1)),s("div",te,l(((h=i.value)==null?void 0:h.category)||"-"),1)])])]}),_:1}),r(n(p),null,{header:o(()=>[s("div",ae,[e[32]||(e[32]=s("h3",null,"Código QR",-1)),r(n(b),{size:"sm",variant:"secondary",onClick:E},{default:o(()=>[...e[31]||(e[31]=[m("🖨️ Imprimir",-1)])]),_:1})])]),default:o(()=>[s("div",ie,[s("a",{href:C.value,target:"_blank",rel:"noreferrer",class:"qr-link"},[i.value?(v(),I(os,{key:0,ref_key:"qrRef",ref:S,value:C.value,caption:C.value},null,8,["value","caption"])):q("",!0)],8,oe)])]),_:1}),r(n(p),null,{header:o(()=>[...e[33]||(e[33]=[s("h3",null,"Responsável",-1)])]),default:o(()=>[s("div",le,[e[35]||(e[35]=s("div",{class:"responsible-avatar"},[s("i",{class:"fas fa-user-hard-hat"})],-1)),s("div",ne,[s("div",re,l(U.value),1),e[34]||(e[34]=s("div",{class:"responsible-role"},"Equipe de manutenção",-1))])])]),_:1}),r(n(p),null,{header:o(()=>[...e[36]||(e[36]=[s("h3",null,"Métricas",-1)])]),default:o(()=>[s("div",de,[s("div",ue,[e[37]||(e[37]=s("div",{class:"metric-label"},"Total OS:",-1)),s("div",ce,l(f.value.totalOrders),1)]),s("div",ve,[e[38]||(e[38]=s("div",{class:"metric-label"},"OS Pendentes:",-1)),s("div",me,l(f.value.pendingOrders),1)]),s("div",pe,[e[39]||(e[39]=s("div",{class:"metric-label"},"Taxa Conclusão:",-1)),s("div",fe,l(f.value.completionRate)+"%",1)]),s("div",ge,[e[40]||(e[40]=s("div",{class:"metric-label"},"Última Manutenção:",-1)),s("div",_e,l(O(f.value.lastMaintenance)),1)]),s("div",he,[e[41]||(e[41]=s("div",{class:"metric-label"},"OS Corretivas:",-1)),s("div",ye,l(f.value.corrective),1)]),s("div",be,[e[42]||(e[42]=s("div",{class:"metric-label"},"OS Preventivas:",-1)),s("div",we,l(f.value.preventive),1)])])]),_:1})])])])):(v(),y("div",ke,[e[44]||(e[44]=s("h2",null,"Ativo não encontrado",-1)),e[45]||(e[45]=s("p",null,"O ativo solicitado não existe ou foi removido.",-1)),r(n(b),{variant:"primary",onClick:e[2]||(e[2]=a=>n(k).push({name:"assets"}))},{default:o(()=>[...e[43]||(e[43]=[m("Voltar para Ativos",-1)])]),_:1})]))}}),Ie=is(Oe,[["__scopeId","data-v-b7f7b061"]]);export{Ie as default};

import{d as lt,u as nt,a as ot,p as it,H as rt,c as P,l as k,b as d,o,j as i,w as l,e,h as v,t as u,i as n,n as dt,A as N,F as z,f as M,g as y,k as W,P as j,x as p,B as b,r as O,q as x,v as B,z as ut,_ as vt}from"./index-CEWcok4S.js";import{Q as H}from"./QRPanel-DRmxbxSE.js";const ct={class:"workorder-detail"},pt={key:0,class:"not-found"},mt={class:"mt-4"},ft={class:"detail-header"},yt={class:"header-content"},kt={class:"workorder-title"},bt={class:"workorder-badges"},gt={class:"workorder-description"},_t={class:"header-actions"},ht={class:"detail-grid"},Ct={class:"info-grid"},It={class:"info-item"},wt={class:"info-item"},St={class:"info-item"},At={class:"info-item"},zt={class:"info-item"},$t={class:"info-item"},Dt={class:"info-item"},Ot={class:"info-item"},Rt={key:0,class:"info-item"},Pt={key:1,class:"info-item"},Nt={key:2,class:"info-item"},xt={key:0,class:"description-section"},Bt={class:"qr-grid"},Tt={class:"qr-item"},Lt={class:"qr-title"},qt={class:"qr-actions"},Vt={key:0,class:"qr-item"},Qt={class:"qr-actions"},Ut={class:"card-header"},Et={key:0,class:"empty-state"},Ft={key:1,class:"checklist-items"},Mt=["checked","onChange"],Wt={key:0,class:"empty-state"},jt={key:1,class:"technicians-list"},Ht={class:"technician-avatar"},Gt={class:"technician-info"},Jt={class:"technician-name"},Kt={class:"card-header"},Xt={key:0,class:"add-form"},Yt={key:1,class:"empty-state"},Zt={key:2,class:"parts-list"},te={class:"part-info"},ee={class:"part-description"},se={class:"part-details"},ae={class:"card-header"},le={key:0,class:"add-form"},ne={key:1,class:"empty-state"},oe={key:2,class:"labor-list"},ie={class:"labor-info"},re={class:"labor-description"},de={class:"labor-details"},ue={class:"costs-summary"},ve={class:"cost-item"},ce={class:"cost-item"},pe={class:"cost-total"},me={class:"card-header"},fe={key:0,class:"add-form"},ye={key:1,class:"empty-state"},ke={key:2,class:"notes-content"},be=lt({__name:"WorkOrderDetailView",setup(ge){const G=rt(),m=nt(),R=ot(),J=it(),$=G.params.id,s=P(()=>m.byId($)),T=k(null),L=k(null);function q(){return"https://lucassuzart.github.io/Manutencao"}const V=P(()=>`${q()}/os/${$}`),Q=P(()=>{var r;return(r=s.value)!=null&&r.assetId?`${q()}/ativos/${s.value.assetId}`:""});function U(r,t,f){if(!r)return;const a=window.open("","_blank","width=400,height=500");if(!a)return;const c=`
    <html><head><meta charset='utf-8'/><title>${t}</title>
    <style>body{font-family:Arial,sans-serif;text-align:center;padding:12px}img{width:240px;height:240px}.t{margin-top:8px;font-weight:600}.s{color:#555}</style>
    </head><body>
    <img src='${r}' alt='QR' />
    <div class='t'>${t}</div>
    ${f?`<div class='s'>${f}</div>`:""}
    <script>window.onload=()=>{window.print();setTimeout(()=>window.close(),300)}<\/script>
    </body></html>`;a.document.write(c),a.document.close()}const h=k(""),C=k(""),D=k(1),I=k(!1),w=k(!1),S=k(!1);function K(){s.value&&(s.value.status==="open"?m.update(s.value.id,{status:"in_progress",startedAt:new Date().toISOString()}):s.value.status==="in_progress"&&m.update(s.value.id,{status:"completed",completedAt:new Date().toISOString()}))}function X(){var r;s.value&&m.addChecklistItem(s.value.id,"Item "+((((r=s.value.checklist)==null?void 0:r.length)||0)+1))}function Y(r){s.value&&m.toggleChecklistItem(s.value.id,r)}function Z(){if(!s.value||!h.value.trim())return;const r=s.value.notes||"",t=`[${new Date().toLocaleString("pt-BR")}] ${h.value.trim()}
`;m.update(s.value.id,{notes:r+t}),h.value="",I.value=!1}function tt(){if(!s.value||!C.value.trim())return;const r={inventoryItemId:C.value.trim(),quantity:1,unitCost:0},t=s.value.parts||[];m.update(s.value.id,{parts:[...t,r]}),C.value="",w.value=!1}function et(){if(!s.value)return;const r={technicianId:"default-technician",hours:D.value,hourlyRate:50},t=s.value.labor||[];m.update(s.value.id,{labor:[...t,r]}),D.value=1,S.value=!1}function st(r){if(!s.value)return;const t=s.value.parts||[];m.update(s.value.id,{parts:t.filter(f=>f.inventoryItemId!==r)})}function at(r){if(!s.value)return;const t=s.value.labor||[];m.update(s.value.id,{labor:t.filter(f=>f.technicianId!==r)})}function E(r){const t=J.technicians.find(f=>f.id===r);return t?t.name:"T√©cnico n√£o encontrado"}function A(r){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r)}function _(r){return new Date(r).toLocaleString("pt-BR")}return console.log("Work Orders dispon√≠veis:",m.workOrders.map(r=>({id:r.id,code:r.code}))),console.log("ID solicitado:",$),(r,t)=>{const f=dt("RouterLink");return o(),d("div",ct,[s.value?(o(),d(z,{key:1},[e("div",ft,[e("div",yt,[e("div",kt,[e("h1",null,"üìã OS "+u(s.value.code||s.value.id.substring(0,8)),1),e("div",bt,[i(n(W),{status:s.value.status,type:"workorder",readonly:""},null,8,["status"]),i(n(j),{priority:s.value.priority},null,8,["priority"])])]),e("p",gt,u(s.value.title),1)]),e("div",_t,[i(n(p),{variant:"primary",onClick:K,disabled:s.value.status==="completed"||s.value.status==="canceled"},{default:l(()=>[v(u(s.value.status==="open"?"‚ñ∂Ô∏è Iniciar":s.value.status==="in_progress"?"‚úÖ Finalizar":"Conclu√≠da"),1)]),_:1},8,["disabled"])])]),s.value.status==="completed"?(o(),M(n(N),{key:0,type:"success",title:"‚úÖ Ordem de Servi√ßo Conclu√≠da",class:"status-alert"},{default:l(()=>[v(" Esta OS foi finalizada em "+u(_(s.value.completedAt||s.value.updatedAt)),1)]),_:1})):s.value.plannedEnd&&new Date(s.value.plannedEnd)<new Date?(o(),M(n(N),{key:1,type:"warning",title:"‚ö†Ô∏è Prazo Vencido",class:"status-alert"},{default:l(()=>[...t[14]||(t[14]=[v(" Esta OS est√° atrasada em rela√ß√£o ao prazo planejado ",-1)])]),_:1})):y("",!0),e("div",ht,[i(n(b),{class:"info-card"},{header:l(()=>[...t[15]||(t[15]=[e("h3",null,"üìã Informa√ß√µes B√°sicas",-1)])]),default:l(()=>{var a;return[e("div",Ct,[e("div",It,[t[16]||(t[16]=e("label",null,"C√≥digo OS",-1)),e("span",null,u(s.value.code||s.value.id.substring(0,8)),1)]),e("div",wt,[t[17]||(t[17]=e("label",null,"T√≠tulo",-1)),e("span",null,u(s.value.title),1)]),e("div",St,[t[18]||(t[18]=e("label",null,"Status",-1)),i(n(W),{status:s.value.status,type:"workorder",readonly:""},null,8,["status"])]),e("div",At,[t[19]||(t[19]=e("label",null,"Prioridade",-1)),i(n(j),{priority:s.value.priority},null,8,["priority"])]),e("div",zt,[t[20]||(t[20]=e("label",null,"Tipo",-1)),e("span",null,u(s.value.type==="corrective"?"Corretiva":s.value.type==="preventive"?"Preventiva":s.value.type==="predictive"?"Preditiva":s.value.type==="inspection"?"Inspe√ß√£o":"Melhoria"),1)]),e("div",$t,[t[21]||(t[21]=e("label",null,"Ativo",-1)),e("span",null,u(s.value.assetId?(a=n(R).byId(s.value.assetId))==null?void 0:a.name:"-"),1)]),e("div",Dt,[t[22]||(t[22]=e("label",null,"Criado em",-1)),e("span",null,u(_(s.value.createdAt)),1)]),e("div",Ot,[t[23]||(t[23]=e("label",null,"Atualizado em",-1)),e("span",null,u(_(s.value.updatedAt)),1)]),s.value.startedAt?(o(),d("div",Rt,[t[24]||(t[24]=e("label",null,"Iniciado em",-1)),e("span",null,u(_(s.value.startedAt)),1)])):y("",!0),s.value.completedAt?(o(),d("div",Pt,[t[25]||(t[25]=e("label",null,"Finalizado em",-1)),e("span",null,u(_(s.value.completedAt)),1)])):y("",!0),s.value.plannedStart?(o(),d("div",Nt,[t[26]||(t[26]=e("label",null,"Planejado para",-1)),e("span",null,u(_(s.value.plannedStart)),1)])):y("",!0)]),s.value.description?(o(),d("div",xt,[t[27]||(t[27]=e("h4",null,"Descri√ß√£o",-1)),e("p",null,u(s.value.description),1)])):y("",!0)]}),_:1}),i(n(b),{class:"qr-card"},{header:l(()=>[...t[28]||(t[28]=[e("div",{class:"card-header"},[e("h3",null,"üîó QR Codes")],-1)])]),default:l(()=>[e("div",Bt,[e("div",Tt,[e("div",Lt,"OS "+u(s.value.code),1),i(H,{ref_key:"osQrRef",ref:T,value:V.value,caption:V.value},null,8,["value","caption"]),e("div",qt,[i(n(p),{size:"sm",variant:"secondary",onClick:t[0]||(t[0]=a=>{var c;return U(((c=T.value)==null?void 0:c.toDataURL())||"",`OS ${s.value.code}`)})},{default:l(()=>[...t[29]||(t[29]=[v("üñ®Ô∏è Imprimir",-1)])]),_:1})])]),s.value.assetId?(o(),d("div",Vt,[t[31]||(t[31]=e("div",{class:"qr-title"},"Ativo",-1)),i(H,{ref_key:"assetQrRef",ref:L,value:Q.value,caption:Q.value},null,8,["value","caption"]),e("div",Qt,[i(n(p),{size:"sm",variant:"secondary",onClick:t[1]||(t[1]=a=>{var c,g,F;return U(((c=L.value)==null?void 0:c.toDataURL())||"",((g=n(R).byId(s.value.assetId))==null?void 0:g.name)||"Ativo",((F=n(R).byId(s.value.assetId))==null?void 0:F.code)||"")})},{default:l(()=>[...t[30]||(t[30]=[v("üñ®Ô∏è Imprimir",-1)])]),_:1})])])):y("",!0)])]),_:1}),i(n(b),{class:"checklist-card"},{header:l(()=>[e("div",Ut,[t[33]||(t[33]=e("h3",null,"‚úÖ Checklist",-1)),i(n(p),{variant:"secondary",size:"sm",onClick:X},{default:l(()=>[...t[32]||(t[32]=[v("‚ûï Item",-1)])]),_:1})])]),default:l(()=>[!s.value.checklist||s.value.checklist.length===0?(o(),d("div",Et,[...t[34]||(t[34]=[e("p",null,"Nenhum item no checklist",-1)])])):(o(),d("div",Ft,[(o(!0),d(z,null,O(s.value.checklist,a=>(o(),d("div",{key:a.id,class:ut(["checklist-item",{completed:a.completed}])},[e("input",{type:"checkbox",checked:a.completed,onChange:c=>Y(a.id)},null,40,Mt),e("span",null,u(a.description),1)],2))),128))]))]),_:1}),i(n(b),{class:"technicians-card"},{header:l(()=>[...t[35]||(t[35]=[e("h3",null,"üë• Respons√°veis",-1)])]),default:l(()=>[!s.value.assignedToIds||s.value.assignedToIds.length===0?(o(),d("div",Wt,[...t[36]||(t[36]=[e("p",null,"Nenhum respons√°vel atribu√≠do",-1)])])):(o(),d("div",jt,[(o(!0),d(z,null,O(s.value.assignedToIds,a=>(o(),d("div",{key:a,class:"technician-item"},[e("div",Ht,u(E(a).charAt(0).toUpperCase()),1),e("div",Gt,[e("div",Jt,u(E(a)),1)])]))),128))]))]),_:1}),i(n(b),{class:"parts-card"},{header:l(()=>[e("div",Kt,[t[38]||(t[38]=e("h3",null,"üîß Pe√ßas Utilizadas",-1)),i(n(p),{variant:"secondary",size:"sm",onClick:t[2]||(t[2]=a=>w.value=!w.value)},{default:l(()=>[...t[37]||(t[37]=[v("‚ûï Pe√ßa",-1)])]),_:1})])]),default:l(()=>[w.value?(o(),d("div",Xt,[x(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>C.value=a),placeholder:"Descri√ß√£o da pe√ßa",class:"form-input"},null,512),[[B,C.value]]),i(n(p),{variant:"primary",size:"sm",onClick:tt},{default:l(()=>[...t[39]||(t[39]=[v("Adicionar",-1)])]),_:1}),i(n(p),{variant:"secondary",size:"sm",onClick:t[4]||(t[4]=a=>w.value=!1)},{default:l(()=>[...t[40]||(t[40]=[v("Cancelar",-1)])]),_:1})])):y("",!0),!s.value.parts||s.value.parts.length===0?(o(),d("div",Yt,[...t[41]||(t[41]=[e("p",null,"Nenhuma pe√ßa registrada",-1)])])):(o(),d("div",Zt,[(o(!0),d(z,null,O(s.value.parts,(a,c)=>(o(),d("div",{key:c,class:"part-item"},[e("div",te,[e("div",ee,"Item ID: "+u(a.inventoryItemId),1),e("div",se," Qtd: "+u(a.quantity)+" | Custo Unit.: "+u(A(a.unitCost)),1)]),i(n(p),{variant:"danger",size:"sm",onClick:g=>st(a.inventoryItemId)},{default:l(()=>[...t[42]||(t[42]=[v("üóëÔ∏è",-1)])]),_:1},8,["onClick"])]))),128))]))]),_:1}),i(n(b),{class:"labor-card"},{header:l(()=>[e("div",ae,[t[44]||(t[44]=e("h3",null,"üë∑ M√£o de Obra",-1)),i(n(p),{variant:"secondary",size:"sm",onClick:t[5]||(t[5]=a=>S.value=!S.value)},{default:l(()=>[...t[43]||(t[43]=[v("‚ûï Trabalho",-1)])]),_:1})])]),default:l(()=>[S.value?(o(),d("div",le,[x(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>D.value=a),type:"number",placeholder:"Horas",class:"form-input",min:"0.5",step:"0.5"},null,512),[[B,D.value,void 0,{number:!0}]]),i(n(p),{variant:"primary",size:"sm",onClick:et},{default:l(()=>[...t[45]||(t[45]=[v("Adicionar",-1)])]),_:1}),i(n(p),{variant:"secondary",size:"sm",onClick:t[7]||(t[7]=a=>S.value=!1)},{default:l(()=>[...t[46]||(t[46]=[v("Cancelar",-1)])]),_:1})])):y("",!0),!s.value.labor||s.value.labor.length===0?(o(),d("div",ne,[...t[47]||(t[47]=[e("p",null,"Nenhum trabalho registrado",-1)])])):(o(),d("div",oe,[(o(!0),d(z,null,O(s.value.labor,(a,c)=>(o(),d("div",{key:c,class:"labor-item"},[e("div",ie,[e("div",re,"T√©cnico ID: "+u(a.technicianId),1),e("div",de,u(a.hours)+"h | Taxa: "+u(A(a.hourlyRate)),1)]),i(n(p),{variant:"danger",size:"sm",onClick:g=>at(a.technicianId)},{default:l(()=>[...t[48]||(t[48]=[v("üóëÔ∏è",-1)])]),_:1},8,["onClick"])]))),128))]))]),_:1}),i(n(b),{class:"costs-card"},{header:l(()=>[...t[49]||(t[49]=[e("h3",null,"üí∞ Custos",-1)])]),default:l(()=>{var a,c,g;return[e("div",ue,[e("div",ve,[t[50]||(t[50]=e("span",null,"Pe√ßas:",-1)),e("span",null,u(A(((a=s.value.costs)==null?void 0:a.parts)||0)),1)]),e("div",ce,[t[51]||(t[51]=e("span",null,"M√£o de Obra:",-1)),e("span",null,u(A(((c=s.value.costs)==null?void 0:c.labor)||0)),1)]),e("div",pe,[t[52]||(t[52]=e("span",null,"Total:",-1)),e("span",null,u(A(((g=s.value.costs)==null?void 0:g.total)||0)),1)])])]}),_:1}),i(n(b),{class:"notes-card"},{header:l(()=>[e("div",me,[t[54]||(t[54]=e("h3",null,"üìù Notas e Observa√ß√µes",-1)),i(n(p),{variant:"secondary",size:"sm",onClick:t[8]||(t[8]=a=>I.value=!I.value)},{default:l(()=>[...t[53]||(t[53]=[v("‚ûï Nota",-1)])]),_:1})])]),default:l(()=>[I.value?(o(),d("div",fe,[x(e("textarea",{"onUpdate:modelValue":t[9]||(t[9]=a=>h.value=a),placeholder:"Digite sua nota...",rows:"3",class:"form-textarea"},null,512),[[B,h.value]]),i(n(p),{variant:"primary",size:"sm",onClick:Z},{default:l(()=>[...t[55]||(t[55]=[v("Salvar",-1)])]),_:1}),i(n(p),{variant:"secondary",size:"sm",onClick:t[10]||(t[10]=a=>I.value=!1)},{default:l(()=>[...t[56]||(t[56]=[v("Cancelar",-1)])]),_:1})])):y("",!0),s.value.notes?(o(),d("div",ke,[e("pre",null,u(s.value.notes),1)])):(o(),d("div",ye,[...t[57]||(t[57]=[e("p",null,"Nenhuma nota registrada",-1)])]))]),_:1})])],64)):(o(),d("div",pt,[i(n(N),{type:"error",title:"‚ùå Ordem de Servi√ßo n√£o encontrada"},{default:l(()=>[e("p",null,[t[11]||(t[11]=v(" A Ordem de Servi√ßo com ID ",-1)),e("strong",null,u(n($)),1),t[12]||(t[12]=v(" n√£o foi encontrada. ",-1))]),e("div",mt,[i(f,{to:"/os",class:"btn btn-primary"},{default:l(()=>[...t[13]||(t[13]=[v("‚Üê Voltar para lista de OS",-1)])]),_:1})])]),_:1})]))])}}}),Ce=vt(be,[["__scopeId","data-v-9980db73"]]);export{Ce as default};

import{d as le,u as ne,a as oe,l as ie,G as re,c as N,m as k,b as d,o,j as i,w as l,e as t,h as v,t as u,i as n,H as de,A as P,F as $,f as M,g as y,k as W,P as j,s as p,B as b,r as D,n as x,v as T,y as ue,_ as ve}from"./index-hUmahst3.js";import{Q as H}from"./QRPanel-SkBbQ9oG.js";const ce={class:"workorder-detail"},pe={key:0,class:"not-found"},me={class:"mt-4"},fe={class:"detail-header"},ye={class:"header-content"},ke={class:"workorder-title"},be={class:"workorder-badges"},ge={class:"workorder-description"},_e={class:"header-actions"},Ce={class:"detail-grid"},he={class:"info-grid"},Ie={class:"info-item"},we={class:"info-item"},Se={class:"info-item"},Ae={class:"info-item"},$e={class:"info-item"},ze={class:"info-item"},Oe={class:"info-item"},De={class:"info-item"},Re={key:0,class:"info-item"},Ne={key:1,class:"info-item"},Pe={key:2,class:"info-item"},xe={key:0,class:"description-section"},Te={class:"qr-grid"},Be={class:"qr-item"},Le={class:"qr-title"},Ve={class:"qr-actions"},qe={key:0,class:"qr-item"},Qe={class:"qr-actions"},Ue={class:"card-header"},Ee={key:0,class:"empty-state"},Fe={key:1,class:"checklist-items"},Me=["checked","onChange"],We={key:0,class:"empty-state"},je={key:1,class:"technicians-list"},He={class:"technician-avatar"},Ge={class:"technician-info"},Je={class:"technician-name"},Ke={class:"card-header"},Xe={key:0,class:"add-form"},Ye={key:1,class:"empty-state"},Ze={key:2,class:"parts-list"},et={class:"part-info"},tt={class:"part-description"},st={class:"part-details"},at={class:"card-header"},lt={key:0,class:"add-form"},nt={key:1,class:"empty-state"},ot={key:2,class:"labor-list"},it={class:"labor-info"},rt={class:"labor-description"},dt={class:"labor-details"},ut={class:"costs-summary"},vt={class:"cost-item"},ct={class:"cost-item"},pt={class:"cost-total"},mt={class:"card-header"},ft={key:0,class:"add-form"},yt={key:1,class:"empty-state"},kt={key:2,class:"notes-content"},bt=le({__name:"WorkOrderDetailView",setup(gt){const G=re(),m=ne(),R=oe(),J=ie(),z=G.params.id,s=N(()=>m.byId(z)),B=k(null),L=k(null),V=window.location.origin,q=N(()=>`${V}/os/${z}`),Q=N(()=>{var r;return(r=s.value)!=null&&r.assetId?`${V}/ativos/${s.value.assetId}`:""});function U(r,e,f){if(!r)return;const a=window.open("","_blank","width=400,height=500");if(!a)return;const c=`
    <html><head><meta charset='utf-8'/><title>${e}</title>
    <style>body{font-family:Arial,sans-serif;text-align:center;padding:12px}img{width:240px;height:240px}.t{margin-top:8px;font-weight:600}.s{color:#555}</style>
    </head><body>
    <img src='${r}' alt='QR' />
    <div class='t'>${e}</div>
    ${f?`<div class='s'>${f}</div>`:""}
    <script>window.onload=()=>{window.print();setTimeout(()=>window.close(),300)}<\/script>
    </body></html>`;a.document.write(c),a.document.close()}const C=k(""),h=k(""),O=k(1),I=k(!1),w=k(!1),S=k(!1);function K(){s.value&&(s.value.status==="open"?m.update(s.value.id,{status:"in_progress",startedAt:new Date().toISOString()}):s.value.status==="in_progress"&&m.update(s.value.id,{status:"completed",completedAt:new Date().toISOString()}))}function X(){var r;s.value&&m.addChecklistItem(s.value.id,"Item "+((((r=s.value.checklist)==null?void 0:r.length)||0)+1))}function Y(r){s.value&&m.toggleChecklistItem(s.value.id,r)}function Z(){if(!s.value||!C.value.trim())return;const r=s.value.notes||"",e=`[${new Date().toLocaleString("pt-BR")}] ${C.value.trim()}
`;m.update(s.value.id,{notes:r+e}),C.value="",I.value=!1}function ee(){if(!s.value||!h.value.trim())return;const r={inventoryItemId:h.value.trim(),quantity:1,unitCost:0},e=s.value.parts||[];m.update(s.value.id,{parts:[...e,r]}),h.value="",w.value=!1}function te(){if(!s.value)return;const r={technicianId:"default-technician",hours:O.value,hourlyRate:50},e=s.value.labor||[];m.update(s.value.id,{labor:[...e,r]}),O.value=1,S.value=!1}function se(r){if(!s.value)return;const e=s.value.parts||[];m.update(s.value.id,{parts:e.filter(f=>f.inventoryItemId!==r)})}function ae(r){if(!s.value)return;const e=s.value.labor||[];m.update(s.value.id,{labor:e.filter(f=>f.technicianId!==r)})}function E(r){const e=J.technicians.find(f=>f.id===r);return e?e.name:"T√©cnico n√£o encontrado"}function A(r){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r)}function _(r){return new Date(r).toLocaleString("pt-BR")}return console.log("Work Orders dispon√≠veis:",m.workOrders.map(r=>({id:r.id,code:r.code}))),console.log("ID solicitado:",z),(r,e)=>{const f=de("RouterLink");return o(),d("div",ce,[s.value?(o(),d($,{key:1},[t("div",fe,[t("div",ye,[t("div",ke,[t("h1",null,"üìã OS "+u(s.value.code||s.value.id.substring(0,8)),1),t("div",be,[i(n(W),{status:s.value.status,type:"workorder",readonly:""},null,8,["status"]),i(n(j),{priority:s.value.priority},null,8,["priority"])])]),t("p",ge,u(s.value.title),1)]),t("div",_e,[i(n(p),{variant:"primary",onClick:K,disabled:s.value.status==="completed"||s.value.status==="canceled"},{default:l(()=>[v(u(s.value.status==="open"?"‚ñ∂Ô∏è Iniciar":s.value.status==="in_progress"?"‚úÖ Finalizar":"Conclu√≠da"),1)]),_:1},8,["disabled"])])]),s.value.status==="completed"?(o(),M(n(P),{key:0,type:"success",title:"‚úÖ Ordem de Servi√ßo Conclu√≠da",class:"status-alert"},{default:l(()=>[v(" Esta OS foi finalizada em "+u(_(s.value.completedAt||s.value.updatedAt)),1)]),_:1})):s.value.plannedEnd&&new Date(s.value.plannedEnd)<new Date?(o(),M(n(P),{key:1,type:"warning",title:"‚ö†Ô∏è Prazo Vencido",class:"status-alert"},{default:l(()=>[...e[14]||(e[14]=[v(" Esta OS est√° atrasada em rela√ß√£o ao prazo planejado ",-1)])]),_:1})):y("",!0),t("div",Ce,[i(n(b),{class:"info-card"},{header:l(()=>[...e[15]||(e[15]=[t("h3",null,"üìã Informa√ß√µes B√°sicas",-1)])]),default:l(()=>{var a;return[t("div",he,[t("div",Ie,[e[16]||(e[16]=t("label",null,"C√≥digo OS",-1)),t("span",null,u(s.value.code||s.value.id.substring(0,8)),1)]),t("div",we,[e[17]||(e[17]=t("label",null,"T√≠tulo",-1)),t("span",null,u(s.value.title),1)]),t("div",Se,[e[18]||(e[18]=t("label",null,"Status",-1)),i(n(W),{status:s.value.status,type:"workorder",readonly:""},null,8,["status"])]),t("div",Ae,[e[19]||(e[19]=t("label",null,"Prioridade",-1)),i(n(j),{priority:s.value.priority},null,8,["priority"])]),t("div",$e,[e[20]||(e[20]=t("label",null,"Tipo",-1)),t("span",null,u(s.value.type==="corrective"?"Corretiva":s.value.type==="preventive"?"Preventiva":s.value.type==="predictive"?"Preditiva":s.value.type==="inspection"?"Inspe√ß√£o":"Melhoria"),1)]),t("div",ze,[e[21]||(e[21]=t("label",null,"Ativo",-1)),t("span",null,u(s.value.assetId?(a=n(R).byId(s.value.assetId))==null?void 0:a.name:"-"),1)]),t("div",Oe,[e[22]||(e[22]=t("label",null,"Criado em",-1)),t("span",null,u(_(s.value.createdAt)),1)]),t("div",De,[e[23]||(e[23]=t("label",null,"Atualizado em",-1)),t("span",null,u(_(s.value.updatedAt)),1)]),s.value.startedAt?(o(),d("div",Re,[e[24]||(e[24]=t("label",null,"Iniciado em",-1)),t("span",null,u(_(s.value.startedAt)),1)])):y("",!0),s.value.completedAt?(o(),d("div",Ne,[e[25]||(e[25]=t("label",null,"Finalizado em",-1)),t("span",null,u(_(s.value.completedAt)),1)])):y("",!0),s.value.plannedStart?(o(),d("div",Pe,[e[26]||(e[26]=t("label",null,"Planejado para",-1)),t("span",null,u(_(s.value.plannedStart)),1)])):y("",!0)]),s.value.description?(o(),d("div",xe,[e[27]||(e[27]=t("h4",null,"Descri√ß√£o",-1)),t("p",null,u(s.value.description),1)])):y("",!0)]}),_:1}),i(n(b),{class:"qr-card"},{header:l(()=>[...e[28]||(e[28]=[t("div",{class:"card-header"},[t("h3",null,"üîó QR Codes")],-1)])]),default:l(()=>[t("div",Te,[t("div",Be,[t("div",Le,"OS "+u(s.value.code),1),i(H,{ref_key:"osQrRef",ref:B,value:q.value,caption:q.value},null,8,["value","caption"]),t("div",Ve,[i(n(p),{size:"sm",variant:"secondary",onClick:e[0]||(e[0]=a=>{var c;return U(((c=B.value)==null?void 0:c.toDataURL())||"",`OS ${s.value.code}`)})},{default:l(()=>[...e[29]||(e[29]=[v("üñ®Ô∏è Imprimir",-1)])]),_:1})])]),s.value.assetId?(o(),d("div",qe,[e[31]||(e[31]=t("div",{class:"qr-title"},"Ativo",-1)),i(H,{ref_key:"assetQrRef",ref:L,value:Q.value,caption:Q.value},null,8,["value","caption"]),t("div",Qe,[i(n(p),{size:"sm",variant:"secondary",onClick:e[1]||(e[1]=a=>{var c,g,F;return U(((c=L.value)==null?void 0:c.toDataURL())||"",((g=n(R).byId(s.value.assetId))==null?void 0:g.name)||"Ativo",((F=n(R).byId(s.value.assetId))==null?void 0:F.code)||"")})},{default:l(()=>[...e[30]||(e[30]=[v("üñ®Ô∏è Imprimir",-1)])]),_:1})])])):y("",!0)])]),_:1}),i(n(b),{class:"checklist-card"},{header:l(()=>[t("div",Ue,[e[33]||(e[33]=t("h3",null,"‚úÖ Checklist",-1)),i(n(p),{variant:"secondary",size:"sm",onClick:X},{default:l(()=>[...e[32]||(e[32]=[v("‚ûï Item",-1)])]),_:1})])]),default:l(()=>[!s.value.checklist||s.value.checklist.length===0?(o(),d("div",Ee,[...e[34]||(e[34]=[t("p",null,"Nenhum item no checklist",-1)])])):(o(),d("div",Fe,[(o(!0),d($,null,D(s.value.checklist,a=>(o(),d("div",{key:a.id,class:ue(["checklist-item",{completed:a.completed}])},[t("input",{type:"checkbox",checked:a.completed,onChange:c=>Y(a.id)},null,40,Me),t("span",null,u(a.description),1)],2))),128))]))]),_:1}),i(n(b),{class:"technicians-card"},{header:l(()=>[...e[35]||(e[35]=[t("h3",null,"üë• Respons√°veis",-1)])]),default:l(()=>[!s.value.assignedToIds||s.value.assignedToIds.length===0?(o(),d("div",We,[...e[36]||(e[36]=[t("p",null,"Nenhum respons√°vel atribu√≠do",-1)])])):(o(),d("div",je,[(o(!0),d($,null,D(s.value.assignedToIds,a=>(o(),d("div",{key:a,class:"technician-item"},[t("div",He,u(E(a).charAt(0).toUpperCase()),1),t("div",Ge,[t("div",Je,u(E(a)),1)])]))),128))]))]),_:1}),i(n(b),{class:"parts-card"},{header:l(()=>[t("div",Ke,[e[38]||(e[38]=t("h3",null,"üîß Pe√ßas Utilizadas",-1)),i(n(p),{variant:"secondary",size:"sm",onClick:e[2]||(e[2]=a=>w.value=!w.value)},{default:l(()=>[...e[37]||(e[37]=[v("‚ûï Pe√ßa",-1)])]),_:1})])]),default:l(()=>[w.value?(o(),d("div",Xe,[x(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>h.value=a),placeholder:"Descri√ß√£o da pe√ßa",class:"form-input"},null,512),[[T,h.value]]),i(n(p),{variant:"primary",size:"sm",onClick:ee},{default:l(()=>[...e[39]||(e[39]=[v("Adicionar",-1)])]),_:1}),i(n(p),{variant:"secondary",size:"sm",onClick:e[4]||(e[4]=a=>w.value=!1)},{default:l(()=>[...e[40]||(e[40]=[v("Cancelar",-1)])]),_:1})])):y("",!0),!s.value.parts||s.value.parts.length===0?(o(),d("div",Ye,[...e[41]||(e[41]=[t("p",null,"Nenhuma pe√ßa registrada",-1)])])):(o(),d("div",Ze,[(o(!0),d($,null,D(s.value.parts,(a,c)=>(o(),d("div",{key:c,class:"part-item"},[t("div",et,[t("div",tt,"Item ID: "+u(a.inventoryItemId),1),t("div",st," Qtd: "+u(a.quantity)+" | Custo Unit.: "+u(A(a.unitCost)),1)]),i(n(p),{variant:"danger",size:"sm",onClick:g=>se(a.inventoryItemId)},{default:l(()=>[...e[42]||(e[42]=[v("üóëÔ∏è",-1)])]),_:1},8,["onClick"])]))),128))]))]),_:1}),i(n(b),{class:"labor-card"},{header:l(()=>[t("div",at,[e[44]||(e[44]=t("h3",null,"üë∑ M√£o de Obra",-1)),i(n(p),{variant:"secondary",size:"sm",onClick:e[5]||(e[5]=a=>S.value=!S.value)},{default:l(()=>[...e[43]||(e[43]=[v("‚ûï Trabalho",-1)])]),_:1})])]),default:l(()=>[S.value?(o(),d("div",lt,[x(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>O.value=a),type:"number",placeholder:"Horas",class:"form-input",min:"0.5",step:"0.5"},null,512),[[T,O.value,void 0,{number:!0}]]),i(n(p),{variant:"primary",size:"sm",onClick:te},{default:l(()=>[...e[45]||(e[45]=[v("Adicionar",-1)])]),_:1}),i(n(p),{variant:"secondary",size:"sm",onClick:e[7]||(e[7]=a=>S.value=!1)},{default:l(()=>[...e[46]||(e[46]=[v("Cancelar",-1)])]),_:1})])):y("",!0),!s.value.labor||s.value.labor.length===0?(o(),d("div",nt,[...e[47]||(e[47]=[t("p",null,"Nenhum trabalho registrado",-1)])])):(o(),d("div",ot,[(o(!0),d($,null,D(s.value.labor,(a,c)=>(o(),d("div",{key:c,class:"labor-item"},[t("div",it,[t("div",rt,"T√©cnico ID: "+u(a.technicianId),1),t("div",dt,u(a.hours)+"h | Taxa: "+u(A(a.hourlyRate)),1)]),i(n(p),{variant:"danger",size:"sm",onClick:g=>ae(a.technicianId)},{default:l(()=>[...e[48]||(e[48]=[v("üóëÔ∏è",-1)])]),_:1},8,["onClick"])]))),128))]))]),_:1}),i(n(b),{class:"costs-card"},{header:l(()=>[...e[49]||(e[49]=[t("h3",null,"üí∞ Custos",-1)])]),default:l(()=>{var a,c,g;return[t("div",ut,[t("div",vt,[e[50]||(e[50]=t("span",null,"Pe√ßas:",-1)),t("span",null,u(A(((a=s.value.costs)==null?void 0:a.parts)||0)),1)]),t("div",ct,[e[51]||(e[51]=t("span",null,"M√£o de Obra:",-1)),t("span",null,u(A(((c=s.value.costs)==null?void 0:c.labor)||0)),1)]),t("div",pt,[e[52]||(e[52]=t("span",null,"Total:",-1)),t("span",null,u(A(((g=s.value.costs)==null?void 0:g.total)||0)),1)])])]}),_:1}),i(n(b),{class:"notes-card"},{header:l(()=>[t("div",mt,[e[54]||(e[54]=t("h3",null,"üìù Notas e Observa√ß√µes",-1)),i(n(p),{variant:"secondary",size:"sm",onClick:e[8]||(e[8]=a=>I.value=!I.value)},{default:l(()=>[...e[53]||(e[53]=[v("‚ûï Nota",-1)])]),_:1})])]),default:l(()=>[I.value?(o(),d("div",ft,[x(t("textarea",{"onUpdate:modelValue":e[9]||(e[9]=a=>C.value=a),placeholder:"Digite sua nota...",rows:"3",class:"form-textarea"},null,512),[[T,C.value]]),i(n(p),{variant:"primary",size:"sm",onClick:Z},{default:l(()=>[...e[55]||(e[55]=[v("Salvar",-1)])]),_:1}),i(n(p),{variant:"secondary",size:"sm",onClick:e[10]||(e[10]=a=>I.value=!1)},{default:l(()=>[...e[56]||(e[56]=[v("Cancelar",-1)])]),_:1})])):y("",!0),s.value.notes?(o(),d("div",kt,[t("pre",null,u(s.value.notes),1)])):(o(),d("div",yt,[...e[57]||(e[57]=[t("p",null,"Nenhuma nota registrada",-1)])]))]),_:1})])],64)):(o(),d("div",pe,[i(n(P),{type:"error",title:"‚ùå Ordem de Servi√ßo n√£o encontrada"},{default:l(()=>[t("p",null,[e[11]||(e[11]=v(" A Ordem de Servi√ßo com ID ",-1)),t("strong",null,u(n(z)),1),e[12]||(e[12]=v(" n√£o foi encontrada. ",-1))]),t("div",me,[i(f,{to:"/os",class:"btn btn-primary"},{default:l(()=>[...e[13]||(e[13]=[v("‚Üê Voltar para lista de OS",-1)])]),_:1})])]),_:1})]))])}}}),ht=ve(bt,[["__scopeId","data-v-9103bb71"]]);export{ht as default};

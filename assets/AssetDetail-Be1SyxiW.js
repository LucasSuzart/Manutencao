import{d as Q,G as U,a as L,I as W,u as F,c as g,m as G,b as h,o as c,e as s,t as l,j as d,w as a,h as m,i as n,s as b,B as p,f as A,g as O,k as C,F as H,r as J,E as K,_ as X}from"./index-hUmahst3.js";import{Q as Y}from"./QRPanel-SkBbQ9oG.js";const Z={key:0,class:"asset-detail page"},ss={class:"page-header"},es={class:"asset-header"},ts={class:"asset-title"},is={class:"muted"},as={class:"detail-grid"},os={class:"detail-main"},ls={class:"info-grid"},ns={class:"info-row"},ds={class:"info-value"},rs={class:"info-row"},us={class:"info-value"},vs={class:"info-row"},cs={class:"info-value"},ms={class:"info-row"},ps={class:"info-value"},fs={class:"info-row"},gs={class:"info-value"},_s={class:"info-row"},ys={class:"info-value"},hs={key:0,class:"empty-item"},bs={class:"order-summary"},ws={class:"order-summary-item"},ks={class:"order-summary-header"},qs={class:"order-count"},Os={class:"order-summary-action"},As={class:"order-summary-item"},Cs={class:"order-summary-header"},Is={class:"order-count"},Rs={class:"order-summary-action"},Ss={class:"card-header"},Ds={key:0,class:"empty-history"},Ts={key:1,class:"order-history"},xs={class:"order-header"},Ps={class:"order-title"},Ms={class:"order-info"},Ns={class:"order-details"},Bs={class:"order-type"},Vs={class:"order-date"},$s={class:"detail-side"},zs={class:"info-grid"},Es={class:"info-row"},js={class:"info-value"},Qs={class:"info-row"},Us={class:"info-value"},Ls={class:"info-row"},Ws={class:"info-value"},Fs={class:"info-row"},Gs={class:"info-value"},Hs={class:"card-header"},Js={class:"qr-container"},Ks={class:"responsible-section"},Xs={class:"responsible-info"},Ys={class:"responsible-name"},Zs={class:"metrics"},se={class:"metric-item"},ee={class:"metric-value"},te={class:"metric-item"},ie={class:"metric-value"},ae={class:"metric-item"},oe={class:"metric-value"},le={class:"metric-item"},ne={class:"metric-value"},de={class:"metric-item"},re={class:"metric-value"},ue={class:"metric-item"},ve={class:"metric-value"},ce={key:1,class:"asset-not-found page"},me=Q({__name:"AssetDetail",setup(pe){const D=U(),k=K(),w=D.params.id,T=L(),x=W(),P=F(),o=g(()=>T.byId(w)),M=g(()=>{var t;return(t=o.value)!=null&&t.location?x.byId(o.value.location):null}),I=g(()=>`${window.location.origin}/ativos/${w}`),R=G(null);function N(){var u;const t=(u=R.value)==null?void 0:u.toDataURL();if(!t||!o.value)return;const e=window.open("","_blank","width=400,height=500");if(!e)return;const i=`
    <html>
    <head>
      <meta charset="utf-8" />
      <title>QR - ${o.value.name}</title>
      <style>
        body { font-family: Arial, sans-serif; text-align:center; padding: 12px; }
        img { width: 240px; height: 240px; }
        .name { margin-top: 8px; font-weight: 600; }
        .code { color: #555; }
      </style>
    </head>
    <body>
      <img src="${t}" alt="QR" />
      <div class="name">${o.value.name}</div>
      <div class="code">${o.value.code}</div>
      <script>window.onload = () => { window.print(); setTimeout(() => window.close(), 300); };<\/script>
    </body>
    </html>`;e.document.write(i),e.document.close()}const B=g(()=>[]),V=g(()=>"TIME MANUTENÇÃO");g(()=>{const t=v.value.filter(e=>e.type==="inspection"&&e.status==="completed");return t.length===0?null:t.sort((e,i)=>new Date(i.completedAt).getTime()-new Date(e.completedAt).getTime())[0].completedAt});const v=g(()=>o.value?P.workOrders.filter(t=>t.assetId===w).sort((t,e)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()):[]),f=g(()=>{if(!v.value.length)return{totalOrders:0,pendingOrders:0,lastMaintenance:null,completedOrders:0,completionRate:0,corrective:0,preventive:0};const t=v.value.length,e=v.value.filter(r=>r.status!=="completed"&&r.status!=="canceled").length,i=v.value.filter(r=>r.status==="completed").length,u=v.value.filter(r=>r.completedAt).sort((r,j)=>new Date(j.completedAt).getTime()-new Date(r.completedAt).getTime())[0],_=v.value.filter(r=>r.type==="corrective").length,y=v.value.filter(r=>r.type==="preventive"||r.type==="predictive"||r.type==="inspection").length;return{totalOrders:t,pendingOrders:e,completedOrders:i,completionRate:t?Math.round(i/t*100):0,lastMaintenance:(u==null?void 0:u.completedAt)||null,corrective:_,preventive:y}});function q(t){return t?new Date(t).toLocaleDateString("pt-BR"):"N/A"}function $(){k.push({name:"assets-edit",params:{id:w}})}function z(){var t;k.push({name:"workorders-new",query:{assetId:w,assetName:(t=o.value)==null?void 0:t.name}})}function E(t){k.push({name:"workorder-detail",params:{id:t}})}function S(t){k.push({name:"workorders",query:{assetId:w,status:t==="pending"?["open","in_progress","paused"]:["completed"]}})}return(t,e)=>o.value?(c(),h("div",Z,[s("div",ss,[s("div",es,[e[3]||(e[3]=s("div",{class:"asset-icon"},[s("i",{class:"fas fa-cogs"})],-1)),s("div",ts,[s("h1",null,l(o.value.name),1),s("p",is,"Código: "+l(o.value.code),1)])]),s("div",null,[d(n(b),{variant:"secondary",onClick:$},{default:a(()=>[...e[4]||(e[4]=[m("Editar",-1)])]),_:1})])]),s("div",as,[s("div",os,[d(n(p),{class:"asset-image-card"},{default:a(()=>[...e[5]||(e[5]=[s("div",{class:"asset-image-container"},[s("img",{src:"https://via.placeholder.com/400x300?text=Imagem+do+Equipamento",alt:"Imagem do equipamento",class:"asset-image"})],-1)])]),_:1}),d(n(p),null,{header:a(()=>[...e[6]||(e[6]=[s("h3",null,"Informações de Manutenção",-1)])]),default:a(()=>{var i,u,_,y;return[s("div",ls,[s("div",ns,[e[7]||(e[7]=s("div",{class:"info-label"},"Status:",-1)),s("div",ds,[o.value.status?(c(),A(n(C),{key:0,status:o.value.status,type:"asset"},null,8,["status"])):O("",!0)])]),s("div",rs,[e[8]||(e[8]=s("div",{class:"info-label"},"Criticidade:",-1)),s("div",us,[o.value.criticality?(c(),A(n(C),{key:0,status:o.value.criticality,type:"criticality"},null,8,["status"])):O("",!0)])]),s("div",vs,[e[9]||(e[9]=s("div",{class:"info-label"},"Instalação:",-1)),s("div",cs,l(q((i=o.value)==null?void 0:i.installationDate)),1)]),s("div",ms,[e[10]||(e[10]=s("div",{class:"info-label"},"Última falha:",-1)),s("div",ps,l(q((u=o.value)==null?void 0:u.lastFailureAt)),1)]),s("div",fs,[e[11]||(e[11]=s("div",{class:"info-label"},"Último reparo:",-1)),s("div",gs,l(q((_=o.value)==null?void 0:_.lastRepairAt)),1)]),s("div",_s,[e[12]||(e[12]=s("div",{class:"info-label"},"Localização:",-1)),s("div",ys,l(((y=M.value)==null?void 0:y.name)||"-"),1)])])]}),_:1}),d(n(p),null,{header:a(()=>[...e[13]||(e[13]=[s("h3",null,"Solicitações",-1)])]),default:a(()=>[B.value.length?O("",!0):(c(),h("div",hs,[...e[14]||(e[14]=[s("p",null,"Nenhuma solicitação de manutenção planejada para este ativo.",-1)])])),e[15]||(e[15]=s("div",{class:"request-list"},[s("div",{class:"request-item"},[s("div",{class:"request-icon"},[s("i",{class:"fas fa-clipboard-list"})]),s("div",{class:"request-content"},[s("div",{class:"request-title"},"Verificação das Pás"),s("div",{class:"tag-container"},[s("span",{class:"tag tag-success"},"Planejada")])])]),s("div",{class:"request-item"},[s("div",{class:"request-icon"},[s("i",{class:"fas fa-search"})]),s("div",{class:"request-content"},[s("div",{class:"request-title"},"Inspeção Preventiva"),s("div",{class:"tag-container"},[s("span",{class:"tag tag-success"},"Planejada")])])]),s("div",{class:"request-item"},[s("div",{class:"request-icon"},[s("i",{class:"fas fa-clipboard-list"})]),s("div",{class:"request-content"},[s("div",{class:"request-title"},"Verificação das Pás"),s("div",{class:"tag-container"},[s("span",{class:"tag tag-success"},"Planejada")])])]),s("div",{class:"request-item"},[s("div",{class:"request-icon"},[s("i",{class:"fas fa-search"})]),s("div",{class:"request-content"},[s("div",{class:"request-title"},"Inspeção Preventiva"),s("div",{class:"tag-container"},[s("span",{class:"tag tag-success"},"Planejada")])])])],-1))]),_:1}),d(n(p),null,{header:a(()=>[...e[16]||(e[16]=[s("h3",null,"Ordens de Serviço",-1)])]),default:a(()=>[s("div",bs,[s("div",ws,[s("div",ks,[e[17]||(e[17]=s("span",null,"Em aberto:",-1)),s("span",qs,l(f.value.pendingOrders),1)]),s("div",Os,[d(n(b),{variant:"ghost",size:"sm",onClick:e[0]||(e[0]=i=>S("pending"))},{default:a(()=>[...e[18]||(e[18]=[m("Visualizar →",-1)])]),_:1})])]),s("div",As,[s("div",Cs,[e[19]||(e[19]=s("span",null,"Concluídas:",-1)),s("span",Is,l(f.value.completedOrders),1)]),s("div",Rs,[d(n(b),{variant:"ghost",size:"sm",onClick:e[1]||(e[1]=i=>S("completed"))},{default:a(()=>[...e[20]||(e[20]=[m("Visualizar →",-1)])]),_:1})])])])]),_:1}),d(n(p),{class:"history-card"},{header:a(()=>[s("div",Ss,[e[22]||(e[22]=s("h3",null,"Histórico de Manutenção",-1)),d(n(b),{variant:"primary",size:"sm",onClick:z},{default:a(()=>[...e[21]||(e[21]=[m("Nova OS",-1)])]),_:1})])]),default:a(()=>[v.value.length===0?(c(),h("div",Ds,[...e[23]||(e[23]=[s("p",null,"Nenhuma ordem de serviço registrada para este ativo.",-1)])])):(c(),h("div",Ts,[(c(!0),h(H,null,J(v.value,i=>(c(),h("div",{key:i.id,class:"order-item"},[s("div",xs,[s("div",Ps,[s("strong",null,l(i.code),1),m(" - "+l(i.title),1)]),d(n(C),{status:i.status,type:"workorder"},null,8,["status"])]),s("div",Ms,[s("div",Ns,[s("div",Bs,[e[24]||(e[24]=s("span",{class:"label"},"Tipo:",-1)),m(" "+l(i.type==="corrective"?"Corretiva":i.type==="preventive"?"Preventiva":i.type==="predictive"?"Preditiva":i.type==="inspection"?"Inspeção":"Melhoria"),1)]),s("div",Vs,[e[25]||(e[25]=s("span",{class:"label"},"Data:",-1)),m(" "+l(q(i.createdAt)),1)])]),d(n(b),{variant:"ghost",size:"sm",onClick:u=>E(i.id)},{default:a(()=>[...e[26]||(e[26]=[m(" Ver detalhes ",-1)])]),_:1},8,["onClick"])])]))),128))]))]),_:1})]),s("div",$s,[d(n(p),null,{header:a(()=>[...e[27]||(e[27]=[s("h3",null,"Informações Gerais",-1)])]),default:a(()=>{var i,u,_,y;return[s("div",zs,[s("div",Es,[e[28]||(e[28]=s("div",{class:"info-label"},"Modelo:",-1)),s("div",js,l(((i=o.value)==null?void 0:i.model)||"Motobomba"),1)]),s("div",Qs,[e[29]||(e[29]=s("div",{class:"info-label"},"Fabricante:",-1)),s("div",Us,l(((u=o.value)==null?void 0:u.manufacturer)||"-"),1)]),s("div",Ls,[e[30]||(e[30]=s("div",{class:"info-label"},"Série:",-1)),s("div",Ws,l(((_=o.value)==null?void 0:_.serialNumber)||"-"),1)]),s("div",Fs,[e[31]||(e[31]=s("div",{class:"info-label"},"Categoria:",-1)),s("div",Gs,l(((y=o.value)==null?void 0:y.category)||"-"),1)])])]}),_:1}),d(n(p),null,{header:a(()=>[s("div",Hs,[e[33]||(e[33]=s("h3",null,"Código QR",-1)),d(n(b),{size:"sm",variant:"secondary",onClick:N},{default:a(()=>[...e[32]||(e[32]=[m("🖨️ Imprimir",-1)])]),_:1})])]),default:a(()=>[s("div",Js,[o.value?(c(),A(Y,{key:0,ref_key:"qrRef",ref:R,value:I.value,caption:I.value},null,8,["value","caption"])):O("",!0)])]),_:1}),d(n(p),null,{header:a(()=>[...e[34]||(e[34]=[s("h3",null,"Responsável",-1)])]),default:a(()=>[s("div",Ks,[e[36]||(e[36]=s("div",{class:"responsible-avatar"},[s("i",{class:"fas fa-user-hard-hat"})],-1)),s("div",Xs,[s("div",Ys,l(V.value),1),e[35]||(e[35]=s("div",{class:"responsible-role"},"Equipe de manutenção",-1))])])]),_:1}),d(n(p),null,{header:a(()=>[...e[37]||(e[37]=[s("h3",null,"Métricas",-1)])]),default:a(()=>[s("div",Zs,[s("div",se,[e[38]||(e[38]=s("div",{class:"metric-label"},"Total OS:",-1)),s("div",ee,l(f.value.totalOrders),1)]),s("div",te,[e[39]||(e[39]=s("div",{class:"metric-label"},"OS Pendentes:",-1)),s("div",ie,l(f.value.pendingOrders),1)]),s("div",ae,[e[40]||(e[40]=s("div",{class:"metric-label"},"Taxa Conclusão:",-1)),s("div",oe,l(f.value.completionRate)+"%",1)]),s("div",le,[e[41]||(e[41]=s("div",{class:"metric-label"},"Última Manutenção:",-1)),s("div",ne,l(q(f.value.lastMaintenance)),1)]),s("div",de,[e[42]||(e[42]=s("div",{class:"metric-label"},"OS Corretivas:",-1)),s("div",re,l(f.value.corrective),1)]),s("div",ue,[e[43]||(e[43]=s("div",{class:"metric-label"},"OS Preventivas:",-1)),s("div",ve,l(f.value.preventive),1)])])]),_:1})])])])):(c(),h("div",ce,[e[45]||(e[45]=s("h2",null,"Ativo não encontrado",-1)),e[46]||(e[46]=s("p",null,"O ativo solicitado não existe ou foi removido.",-1)),d(n(b),{variant:"primary",onClick:e[2]||(e[2]=i=>n(k).push({name:"assets"}))},{default:a(()=>[...e[44]||(e[44]=[m("Voltar para Ativos",-1)])]),_:1})]))}}),_e=X(me,[["__scopeId","data-v-8ef6d28e"]]);export{_e as default};

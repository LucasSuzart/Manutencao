import{d as L,a as q,u as K,m as k,c as x,b as g,o as m,e as s,f as b,g as I,j as i,w as n,h as d,i as o,s as c,t as p,A as W,B as D,D as Z,y as j,J as y,K as S,N as G,F as J,r as R,x as H,M as Q,_ as X}from"./index-OLFv1jP5.js";const Y={class:"page"},ee={class:"page-header"},te={class:"page-header__actions"},le={class:"stats-grid"},ae={class:"stat"},se={class:"stat__value"},oe={class:"stat"},ie={class:"stat__value"},ne={class:"stat"},re={class:"stat__value"},ue={class:"actions"},de={class:"form-grid"},ve={class:"form-full-width"},me={class:"checklist-input"},ce={key:0,class:"checklist-items"},pe=["onClick"],fe=L({__name:"PlansView",setup(ye){var T;const V=q(),N=K(),u=k([{id:"1",code:"PLN-001",title:"Inspeção Mensal Compressor",assetId:((T=V.assets[0])==null?void 0:T.id)||"",strategy:"time",intervalDays:30,lastExecutionAt:"2024-08-15T10:00:00Z",nextDueAt:"2024-09-15T10:00:00Z",active:!0,checklistItems:["Verificar vibração","Verificar temperatura","Verificar pressão","Verificar nível de óleo"]}]),f=k(!1),v=k(null),a=k({code:"",title:"",assetId:"",strategy:"time",intervalDays:30,meterType:"",meterInterval:0,checklistItems:[],checklistInput:""}),_=x(()=>u.value.map(t=>{var e;return{...t,assetName:t.assetId?(e=V.byId(t.assetId))==null?void 0:e.name:"N/A",daysUntilDue:t.nextDueAt?Math.ceil((new Date(t.nextDueAt).getTime()-new Date().getTime())/(1e3*60*60*24)):null,isOverdue:t.nextDueAt?new Date(t.nextDueAt)<new Date:!1}})),h=x(()=>_.value.filter(t=>t.isOverdue&&t.active)),E=x(()=>[{value:"",label:"Selecione um ativo"},...V.assets.map(t=>({value:t.id,label:t.name}))]),M=[{value:"time",label:"Baseado em Tempo"},{value:"meter",label:"Baseado em Medição"},{value:"condition",label:"Baseado em Condição"}],$=[{key:"code",label:"Código"},{key:"title",label:"Título"},{key:"assetName",label:"Ativo"},{key:"strategy",label:"Estratégia",format:t=>({time:"Tempo",meter:"Medição",condition:"Condição"})[t]||t},{key:"intervalDays",label:"Intervalo",format:(t,e)=>e.strategy==="time"?`${t} dias`:e.strategy==="meter"?`${e.meterInterval} ${e.meterType}`:"Por condição"},{key:"nextDueAt",label:"Próxima Execução",format:t=>t?new Date(t).toLocaleDateString():"-"},{key:"daysUntilDue",label:"Dias Restantes",format:(t,e)=>t===null?"-":e.isOverdue?"Vencido":t.toString()}];function U(){a.value={code:"",title:"",assetId:"",strategy:"time",intervalDays:30,meterType:"",meterInterval:0,checklistItems:[],checklistInput:""},v.value=null}function C(){a.value.checklistInput.trim()&&(a.value.checklistItems.push(a.value.checklistInput.trim()),a.value.checklistInput="")}function O(t){a.value.checklistItems.splice(t,1)}function P(){var e,l;if(!a.value.title||!a.value.assetId)return;const t={id:((e=v.value)==null?void 0:e.id)||Date.now().toString(),code:a.value.code||`PLN-${Date.now()}`,title:a.value.title,assetId:a.value.assetId,strategy:a.value.strategy,intervalDays:a.value.intervalDays,meterType:a.value.meterType,meterInterval:a.value.meterInterval,lastExecutionAt:(l=v.value)==null?void 0:l.lastExecutionAt,nextDueAt:w(a.value),active:!0,checklistItems:a.value.checklistItems};if(v.value){const r=u.value.findIndex(A=>A.id===v.value.id);r>-1&&(u.value[r]=t)}else u.value.push(t);U(),f.value=!1}function w(t){const e=new Date;return t.strategy==="time"&&e.setDate(e.getDate()+t.intervalDays),e.toISOString()}function B(t){const e={title:`Execução: ${t.title}`,description:`Execução automática do plano ${t.code}`,assetId:t.assetId,type:"preventive",priority:"medium",status:"open",assignedToIds:[],checklist:t.checklistItems.map(r=>({id:Date.now().toString()+Math.random(),description:r,mandatory:!0,completed:!1})),parts:[],labor:[],costs:{parts:0,labor:0,total:0}};N.create(e);const l=u.value.findIndex(r=>r.id===t.id);l>-1&&(u.value[l].lastExecutionAt=new Date().toISOString(),u.value[l].nextDueAt=w(u.value[l]))}function z(t){v.value=t,a.value={code:t.code,title:t.title,assetId:t.assetId,strategy:t.strategy,intervalDays:t.intervalDays||30,meterType:t.meterType||"",meterInterval:t.meterInterval||0,checklistItems:[...t.checklistItems],checklistInput:""},f.value=!0}function F(t){const e=u.value.findIndex(l=>l.id===t);e>-1&&u.value.splice(e,1)}return(t,e)=>(m(),g("div",Y,[s("div",ee,[e[12]||(e[12]=s("div",{class:"page-header__content"},[s("h1",{class:"page-title"},"Planos de Manutenção"),s("p",{class:"page-subtitle"},"Gerencie planos preventivos e preditivos")],-1)),s("div",te,[i(o(c),{variant:"primary",onClick:e[0]||(e[0]=l=>f.value=!0)},{default:n(()=>[...e[11]||(e[11]=[d(" Novo Plano ",-1)])]),_:1})])]),h.value.length>0?(m(),b(o(W),{key:0,type:"warning",title:"Planos Vencidos",class:"mb-lg"},{default:n(()=>[d(p(h.value.length)+" plano(s) de manutenção estão vencidos e precisam ser executados. ",1)]),_:1})):I("",!0),s("div",le,[i(o(D),null,{default:n(()=>[s("div",ae,[s("div",se,p(u.value.length),1),e[13]||(e[13]=s("div",{class:"stat__label"},"Total de Planos",-1))])]),_:1}),i(o(D),null,{default:n(()=>[s("div",oe,[s("div",ie,p(u.value.filter(l=>l.active).length),1),e[14]||(e[14]=s("div",{class:"stat__label"},"Planos Ativos",-1))])]),_:1}),i(o(D),null,{default:n(()=>[s("div",ne,[s("div",re,p(h.value.length),1),e[15]||(e[15]=s("div",{class:"stat__label"},"Planos Vencidos",-1))])]),_:1})]),i(o(D),null,{default:n(()=>[i(o(Z),{data:_.value,columns:$,searchable:"",sortable:"",striped:"",hoverable:"","empty-text":"Nenhum plano de manutenção cadastrado"},{"cell-daysUntilDue":n(({value:l,item:r})=>[s("span",{class:j({"text-error":r.isOverdue})},p(r.isOverdue?"Vencido":l?`${l} dias`:"-"),3)]),actions:n(({item:l})=>[s("div",ue,[i(o(c),{variant:"outline",size:"sm",onClick:r=>B(l)},{default:n(()=>[...e[16]||(e[16]=[d(" Executar ",-1)])]),_:1},8,["onClick"]),i(o(c),{variant:"ghost",size:"sm",onClick:r=>z(l)},{default:n(()=>[...e[17]||(e[17]=[d(" Editar ",-1)])]),_:1},8,["onClick"]),i(o(c),{variant:"danger",size:"sm",onClick:r=>F(l.id)},{default:n(()=>[...e[18]||(e[18]=[d(" Excluir ",-1)])]),_:1},8,["onClick"])])]),_:1},8,["data"])]),_:1}),i(o(Q),{modelValue:f.value,"onUpdate:modelValue":e[10]||(e[10]=l=>f.value=l),title:v.value?"Editar Plano":"Novo Plano",size:"lg"},{footer:n(()=>[i(o(c),{variant:"ghost",onClick:e[9]||(e[9]=l=>f.value=!1)},{default:n(()=>[...e[21]||(e[21]=[d(" Cancelar ",-1)])]),_:1}),i(o(c),{variant:"primary",onClick:P},{default:n(()=>[d(p(v.value?"Salvar":"Criar")+" Plano ",1)]),_:1})]),default:n(()=>[s("form",{onSubmit:H(P,["prevent"])},[s("div",de,[i(o(y),{modelValue:a.value.code,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.code=l),label:"Código do Plano",placeholder:"PLN-001"},null,8,["modelValue"]),i(o(y),{modelValue:a.value.title,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.title=l),label:"Título do Plano",placeholder:"Inspeção mensal...",required:""},null,8,["modelValue"]),i(o(S),{modelValue:a.value.assetId,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.assetId=l),label:"Ativo",options:E.value,required:""},null,8,["modelValue","options"]),i(o(S),{modelValue:a.value.strategy,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.strategy=l),label:"Estratégia",options:M,required:""},null,8,["modelValue"]),a.value.strategy==="time"?(m(),b(o(y),{key:0,modelValue:a.value.intervalDays,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.intervalDays=l),modelModifiers:{number:!0},label:"Intervalo (dias)",type:"number",placeholder:"30",required:""},null,8,["modelValue"])):I("",!0),a.value.strategy==="meter"?(m(),b(o(y),{key:1,modelValue:a.value.meterType,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.meterType=l),label:"Tipo de Medição",placeholder:"horas, ciclos, km..."},null,8,["modelValue"])):I("",!0),a.value.strategy==="meter"?(m(),b(o(y),{key:2,modelValue:a.value.meterInterval,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.meterInterval=l),modelModifiers:{number:!0},label:"Intervalo de Medição",type:"number",placeholder:"1000"},null,8,["modelValue"])):I("",!0),s("div",ve,[e[20]||(e[20]=s("label",{class:"form-field__label"},"Itens do Checklist",-1)),s("div",me,[i(o(y),{modelValue:a.value.checklistInput,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.checklistInput=l),placeholder:"Digite um item do checklist",onKeyup:G(C,["enter"])},null,8,["modelValue"]),i(o(c),{variant:"outline",size:"sm",onClick:C},{default:n(()=>[...e[19]||(e[19]=[d(" Adicionar ",-1)])]),_:1})]),a.value.checklistItems.length>0?(m(),g("div",ce,[(m(!0),g(J,null,R(a.value.checklistItems,(l,r)=>(m(),g("div",{key:r,class:"checklist-item"},[d(p(l)+" ",1),s("button",{type:"button",onClick:A=>O(r),class:"checklist-remove"}," × ",8,pe)]))),128))])):I("",!0)])])],32)]),_:1},8,["modelValue","title"])]))}}),ke=X(fe,[["__scopeId","data-v-a692db8c"]]);export{ke as default};

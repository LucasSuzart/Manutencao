import{d as X,u as Y,a as Z,l as ee,m as w,c as v,b as o,o as i,e as n,t as l,j as p,w as f,i as g,s as D,h as m,R as te,n as ae,v as ne,F as h,r as S,E as se,y as L,_ as re}from"./index-OLFv1jP5.js";const oe={class:"workorder-calendar"},ie={class:"calendar-header"},le={class:"calendar-title"},de={class:"calendar-nav"},ce={class:"calendar-layout"},ue={class:"calendar-sidebar"},ve={class:"sidebar-search"},pe={class:"sidebar-list"},fe=["onDragstart","onClick"],ge={class:"event-title"},De={class:"event-asset"},me={class:"calendar-container"},he={class:"calendar-days-header"},Se={class:"calendar-time-grid"},ke={class:"calendar-time-column"},_e=["onDragover","onDrop"],we=["onClick"],ye={class:"event-time"},Te={class:"event-title"},Oe={class:"event-asset"},be={class:"event-tech"},Ce=X({__name:"WorkOrderCalendar",setup(Ne){const I=se(),y=Y(),E=Z(),P=ee(),c=w(new Date),T=v(()=>{const t=new Date(c.value),e=t.getDay(),a=t.getDate()-e+(e===0?-6:1);return new Date(t.setDate(a))}),d=w(null),k=w(!1),O=v(()=>{const t=[],e=new Date(T.value);for(let a=0;a<7;a++){const r=new Date(e);r.setDate(e.getDate()+a),t.push(r)}return t});function j(t){return t.toLocaleDateString("pt-BR",{weekday:"short",day:"numeric"})}function B(t){return t.toLocaleDateString("pt-BR",{month:"long",year:"numeric"})}function z(){const t=new Date(c.value);t.setDate(t.getDate()-7),c.value=t}function R(){const t=new Date(c.value);t.setDate(t.getDate()+7),c.value=t}function A(){c.value=new Date}const H=v(()=>{const t=new Date(T.value);t.setHours(0,0,0,0);const e=new Date(t);return e.setDate(e.getDate()+6),e.setHours(23,59,59,999),y.workOrders.filter(a=>{if(!a.plannedStart)return!0;const r=new Date(a.plannedStart);return r>=t&&r<=e})}),V=v(()=>{const t={};return O.value.forEach(e=>{const a=e.toISOString().split("T")[0];t[a]=[]}),H.value.forEach(e=>{if(!e.plannedStart)return;const a=new Date(e.plannedStart).toISOString().split("T")[0];t[a]&&t[a].push(e)}),Object.keys(t).forEach(e=>{t[e].sort((a,r)=>a.plannedStart?r.plannedStart?new Date(a.plannedStart).getTime()-new Date(r.plannedStart).getTime():1:-1)}),t}),b=w(""),$=v(()=>{const t=y.workOrders.filter(a=>!a.plannedStart),e=b.value.trim().toLowerCase();return e?t.filter(a=>a.title.toLowerCase().includes(e)||a.code&&a.code.toLowerCase().includes(e)||C(a.assetId).toLowerCase().includes(e)):t}),F=v(()=>{const t=[];for(let e=7;e<=18;e++)t.push(`${e.toString().padStart(2,"0")}:00`),t.push(`${e.toString().padStart(2,"0")}:30`);return t});function C(t){if(!t)return"Sem ativo";const e=E.byId(t);return e?e.name:"Ativo não encontrado"}function J(t){if(!t||t.length===0)return"Não atribuído";const e=P.byId(t[0]);return e?e.name:"Técnico não encontrado"}function K(){I.push({name:"workorders"})}function W(t){I.push({name:"workorder-detail",params:{id:t.id}})}function x(t){var a;const e=["calendar-event"];switch(t.isNotPlanned&&e.push("event-not-planned"),t.type){case"corrective":e.push("event-corrective");break;case"preventive":e.push("event-preventive");break;case"predictive":e.push("event-predictive");break;case"inspection":e.push("event-inspection");break;default:e.push("event-other")}switch(t.priority){case"low":e.push("priority-low");break;case"medium":e.push("priority-medium");break;case"high":e.push("priority-high");break;case"critical":e.push("priority-critical");break}return k.value&&((a=d.value)==null?void 0:a.id)===t.id&&e.push("is-dragging"),e.join(" ")}function M(t,e){e.isNotPlanned&&t.dataTransfer&&(t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("application/json",JSON.stringify(e)),d.value=e,k.value=!0)}function U(){d.value=null,k.value=!1}function q(t,e,a){!d.value||!d.value.isNotPlanned||(t.preventDefault(),t.dataTransfer.dropEffect="move",t.currentTarget&&t.currentTarget.classList.add("drag-over"))}function G(t){t.currentTarget&&t.currentTarget.classList.remove("drag-over")}function Q(t,e,a){if(t.preventDefault(),t.currentTarget&&t.currentTarget.classList.remove("drag-over"),!d.value||!d.value.isNotPlanned)return;const _=JSON.parse(t.dataTransfer.getData("application/json")).id,[N,s]=e.split(":"),u=new Date(a);u.setHours(parseInt(N),parseInt(s),0,0),y.update(_,{plannedStart:u.toISOString(),plannedEnd:new Date(u.getTime()+2*60*60*1e3).toISOString()}),d.value=null,k.value=!1}return(t,e)=>(i(),o("div",oe,[n("div",ie,[n("div",le,[n("h2",null,l(B(T.value)),1)]),n("div",de,[p(g(te),{to:"/os"},{default:f(()=>[p(g(D),{variant:"secondary",size:"sm"},{default:f(()=>[...e[2]||(e[2]=[m(" Lista de OS ",-1)])]),_:1})]),_:1}),p(g(D),{variant:"secondary",size:"sm",onClick:z},{default:f(()=>[...e[3]||(e[3]=[m(" < Semana anterior ",-1)])]),_:1}),p(g(D),{variant:"primary",size:"sm",onClick:A},{default:f(()=>[...e[4]||(e[4]=[m(" Hoje ",-1)])]),_:1}),p(g(D),{variant:"secondary",size:"sm",onClick:R},{default:f(()=>[...e[5]||(e[5]=[m(" Próxima semana > ",-1)])]),_:1}),p(g(D),{variant:"primary",onClick:K},{default:f(()=>[...e[6]||(e[6]=[m(" + Nova OS ",-1)])]),_:1})])]),n("div",ce,[n("div",ue,[e[7]||(e[7]=n("div",{class:"sidebar-header"},"Não planejadas",-1)),n("div",ve,[ae(n("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),placeholder:"Buscar..."},null,512),[[ne,b.value]])]),n("div",pe,[(i(!0),o(h,null,S($.value,a=>(i(),o("div",{key:a.id,class:L(x({...a,isNotPlanned:!0})),draggable:"true",onDragstart:r=>M(r,{...a,isNotPlanned:!0}),onDragend:U,onClick:r=>W(a)},[n("div",ge,l(a.title),1),n("div",De,l(C(a.assetId)),1)],42,fe))),128))])]),n("div",me,[n("div",he,[e[8]||(e[8]=n("div",{class:"calendar-time-column"},null,-1)),(i(!0),o(h,null,S(O.value,(a,r)=>(i(),o("div",{key:r,class:L(["calendar-day-header",{today:new Date().toDateString()===a.toDateString()}])},l(j(a)),3))),128))]),n("div",Se,[(i(!0),o(h,null,S(F.value,(a,r)=>(i(),o("div",{key:r,class:"calendar-time-row"},[n("div",ke,l(a),1),(i(!0),o(h,null,S(O.value,(_,N)=>(i(),o("div",{key:N,class:"calendar-day-column",onDragover:s=>q(s),onDragleave:e[1]||(e[1]=s=>G(s)),onDrop:s=>Q(s,a,_)},[(i(!0),o(h,null,S(V.value[_.toISOString().split("T")[0]].filter(s=>s.plannedStart?new Date(s.plannedStart).toTimeString().substring(0,5)===a:!1),(s,u)=>(i(),o("div",{key:u,class:L(x(s)),onClick:Le=>W(s)},[n("div",ye,l(s.code),1),n("div",Te,l(s.title),1),n("div",Oe,l(C(s.assetId)),1),n("div",be,l(J(s.assignedToIds)),1)],10,we))),128))],40,_e))),128))]))),128))])])])]))}}),We=re(Ce,[["__scopeId","data-v-83564f10"]]);export{We as default};

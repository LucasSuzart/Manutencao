import{d as U,u as F,a as L,O as j,m as E,c as v,Q as M,b as N,o as W,e as o,j as s,w as c,h as _,i as r,s as V,S as i,K as p,n as w,v as k,B as C,D as $,_ as K}from"./index-OLFv1jP5.js";const Q={class:"page"},q={class:"page-header"},z={class:"page-header__actions"},H={class:"stats-grid"},G={class:"filters-grid"},J={class:"form-field"},X={class:"form-field"},Y={class:"filters-actions"},Z=U({__name:"ReportsView",setup(ee){const S=F(),y=L(),I=j(),a=E({assetId:"",type:"",status:"",priority:"",fromDate:"",toDate:""}),n=v(()=>S.workOrders.filter(e=>{if(a.value.assetId&&e.assetId!==a.value.assetId||a.value.type&&e.type!==a.value.type||a.value.status&&e.status!==a.value.status||a.value.priority&&e.priority!==a.value.priority)return!1;if(a.value.fromDate){const t=new Date(a.value.fromDate);if((e.createdAt?new Date(e.createdAt):new Date)<t)return!1}if(a.value.toDate){const t=new Date(a.value.toDate);if((e.createdAt?new Date(e.createdAt):new Date)>t)return!1}return!0})),u=v(()=>M(n.value)),O=v(()=>[{value:"",label:"Todos os ativos"},...y.assets.map(e=>({value:e.id,label:e.name}))]),T=[{value:"",label:"Todos os tipos"},{value:"corrective",label:"Corretiva"},{value:"preventive",label:"Preventiva"},{value:"predictive",label:"Preditiva"},{value:"inspection",label:"Inspeção"},{value:"improvement",label:"Melhoria"}],x=[{value:"",label:"Todos os status"},{value:"open",label:"Aberto"},{value:"in_progress",label:"Em Progresso"},{value:"paused",label:"Pausado"},{value:"completed",label:"Concluído"},{value:"canceled",label:"Cancelado"}],A=[{value:"",label:"Todas as prioridades"},{value:"low",label:"Baixa"},{value:"medium",label:"Média"},{value:"high",label:"Alta"},{value:"critical",label:"Crítica"}],m=[{key:"code",label:"Código OS",format:(e,t)=>e||t.id.substring(0,8)},{key:"assetId",label:"Ativo",format:e=>{var t;return e?(t=y.byId(e))==null?void 0:t.name:"-"}},{key:"type",label:"Tipo",format:e=>({corrective:"Corretiva",preventive:"Preventiva",predictive:"Preditiva",inspection:"Inspeção",improvement:"Melhoria"})[e]||e},{key:"status",label:"Status",format:e=>({open:"Aberto",in_progress:"Em Progresso",paused:"Pausado",completed:"Concluído",canceled:"Cancelado"})[e]||e},{key:"priority",label:"Prioridade",format:e=>({low:"Baixa",medium:"Média",high:"Alta",critical:"Crítica"})[e]||e},{key:"startedAt",label:"Data Início",format:e=>e?new Date(e).toLocaleDateString():"-"},{key:"completedAt",label:"Data Fim",format:e=>e?new Date(e).toLocaleDateString():"-"},{key:"costs",label:"Custo Total",format:e=>`R$ ${e.total.toFixed(2)}`}],P=v(()=>I.items.filter(e=>e.currentQty<=e.minQty));function h(){a.value={assetId:"",type:"",status:"",priority:"",fromDate:"",toDate:""}}function B(){const e=m.map(d=>d.label).join(","),t=n.value.map(d=>m.map(b=>{try{const g=d[b.key];return`"${(b.format?b.format(g,d):String(g||"")).replace(/"/g,'""')}"`}catch{return'""'}}).join(",")),l=[e,...t].join(`
`),R=new Blob([l],{type:"text/csv;charset=utf-8"}),D=window.URL.createObjectURL(R),f=document.createElement("a");f.href=D,f.download="relatorio-os.csv",f.click(),window.URL.revokeObjectURL(D)}return(e,t)=>(W(),N("div",Q,[o("div",q,[t[7]||(t[7]=o("div",{class:"page-header__content"},[o("h1",{class:"page-title"},"Relatórios"),o("p",{class:"page-subtitle"},"Análise e relatórios de manutenção")],-1)),o("div",z,[s(r(V),{variant:"outline",onClick:B},{default:c(()=>[...t[6]||(t[6]=[_(" Exportar CSV ",-1)])]),_:1})])]),o("div",H,[s(r(i),{title:"Total de OS",value:n.value.length,decimals:0},null,8,["value"]),s(r(i),{title:"OS Concluídas",value:u.value.totalWorkOrders&&u.value.completedWorkOrders||0,decimals:0,color:"success"},null,8,["value"]),s(r(i),{title:"MTTR",value:u.value.mttrHours||0,unit:"horas",color:"warning"},null,8,["value"]),s(r(i),{title:"Custo Total",value:u.value.maintenanceCost||0,unit:"R$",color:"primary"},null,8,["value"]),s(r(i),{title:"Itens com Estoque Baixo",value:P.value.length,decimals:0,color:"danger"},null,8,["value"])]),s(r(C),{title:"Filtros",class:"mb-lg"},{default:c(()=>[o("div",G,[s(r(p),{modelValue:a.value.assetId,"onUpdate:modelValue":t[0]||(t[0]=l=>a.value.assetId=l),label:"Ativo",options:O.value},null,8,["modelValue","options"]),s(r(p),{modelValue:a.value.type,"onUpdate:modelValue":t[1]||(t[1]=l=>a.value.type=l),label:"Tipo",options:T},null,8,["modelValue"]),s(r(p),{modelValue:a.value.status,"onUpdate:modelValue":t[2]||(t[2]=l=>a.value.status=l),label:"Status",options:x},null,8,["modelValue"]),s(r(p),{modelValue:a.value.priority,"onUpdate:modelValue":t[3]||(t[3]=l=>a.value.priority=l),label:"Prioridade",options:A},null,8,["modelValue"]),o("div",J,[t[8]||(t[8]=o("label",{class:"form-field__label"},"Data Inicial",-1)),w(o("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>a.value.fromDate=l),type:"date",class:"form-field__input"},null,512),[[k,a.value.fromDate]])]),o("div",X,[t[9]||(t[9]=o("label",{class:"form-field__label"},"Data Final",-1)),w(o("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>a.value.toDate=l),type:"date",class:"form-field__input"},null,512),[[k,a.value.toDate]])]),o("div",Y,[s(r(V),{variant:"ghost",size:"sm",onClick:h},{default:c(()=>[...t[10]||(t[10]=[_(" Limpar Filtros ",-1)])]),_:1})])])]),_:1}),s(r(C),null,{default:c(()=>[s(r($),{data:n.value,columns:m,searchable:"",sortable:"",striped:"",hoverable:"","empty-text":"Nenhuma ordem de serviço encontrada com os filtros aplicados"},null,8,["data"])]),_:1})]))}}),le=K(Z,[["__scopeId","data-v-20a221ab"]]);export{le as default};
